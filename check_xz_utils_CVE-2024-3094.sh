#!/bin/bash

# Check if vulnerable to xz-utils backdoor
# More info: https://www.kali.org/blog/about-the-xz-backdoor/
# Get the installed version of xz-utils
installed_version=$(apt-cache policy liblzma5 | awk '/Installed:/ {print $2}')

# Check if the installed version is vulnerable
if [[ $installed_version == 5.6.0 || $installed_version == 5.6.1 ]]; then
    echo "Installed version: $installed_version is vulnerable."
    read -p "Do you want to update? (y/n): " choice
    if [[ $choice == "y" ]]; then
        sudo apt update && sudo apt install -y --only-upgrade liblzma5
    fi
else
    echo "Installed version: $installed_version is not vulnerable."
fi